#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Comprehensive pre-commit hook
# Runs linting, format checking, and all tests before commit
# Based on best practices from Context7 research
# 
# To skip this hook: git commit --no-verify

set -e  # Exit on any error

echo "ğŸ” Running comprehensive pre-commit checks..."
echo ""

# Step 1: Run linting
echo "ğŸ“ Step 1/3: Running ESLint..."
if ! npm run lint; then
  echo ""
  echo "âŒ ESLint failed. Please fix linting errors before committing."
  echo "   Tip: Run 'npm run lint:fix' to auto-fix some issues."
  exit 1
fi
echo "âœ… Linting passed"
echo ""

# Step 2: Check code formatting
echo "âœ¨ Step 2/3: Checking code formatting..."
if ! npm run format:check; then
  echo ""
  echo "âŒ Code formatting check failed. Please format your code before committing."
  echo "   Tip: Run 'npm run format' to auto-format your code."
  exit 1
fi
echo "âœ… Formatting check passed"
echo ""

# Step 3: Run all tests (unit, integration, contract)
echo "ğŸ§ª Step 3/3: Running comprehensive tests..."
echo "   - Unit tests..."
echo "   - Integration tests..."
echo "   - Contract tests..."
if ! npm run test:all; then
  echo ""
  echo "âŒ Tests failed. Please fix failing tests before committing."
  exit 1
fi
echo "âœ… All tests passed"
echo ""

echo "ğŸ‰ All pre-commit checks passed! Proceeding with commit..."
exit 0
